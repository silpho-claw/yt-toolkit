<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YT Toolkit ‚Äî The Appiarist</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #0a0a0a;
    --surface: #141414;
    --surface2: #1c1c1c;
    --border: #2a2a2a;
    --text: #f0f0f0;
    --text2: #888;
    --accent: #DD2B23;
    --accent-glow: rgba(221, 43, 35, 0.15);
    --green: #22c55e;
    --blue: #3b82f6;
    --yellow: #eab308;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  h1, h2, h3, h4 { font-family: 'Space Grotesk', sans-serif; }

  .app { max-width: 1200px; margin: 0 auto; padding: 24px; }

  .header {
    display: flex; align-items: center; gap: 16px;
    padding-bottom: 24px; border-bottom: 1px solid var(--border);
    margin-bottom: 32px;
  }
  .header h1 { font-size: 24px; font-weight: 700; }
  .header span { color: var(--text2); font-size: 14px; }
  .header .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent); }

  .setup {
    display: flex; gap: 12px; margin-bottom: 32px; flex-wrap: wrap;
  }
  .setup input, .setup select {
    background: var(--surface); border: 1px solid var(--border);
    color: var(--text); padding: 10px 14px; border-radius: 8px;
    font-size: 13px; font-family: 'DM Sans', sans-serif;
  }
  .setup input { flex: 1; min-width: 200px; }
  .setup input::placeholder { color: var(--text2); }
  .setup .key-saved { color: var(--green); font-size: 12px; align-self: center; }

  .photos {
    display: flex; gap: 12px; margin-bottom: 32px; align-items: center;
  }
  .photo-slot {
    width: 80px; height: 80px; border-radius: 12px;
    border: 2px dashed var(--border); display: flex;
    align-items: center; justify-content: center;
    cursor: pointer; overflow: hidden; position: relative;
    transition: border-color 0.2s;
  }
  .photo-slot:hover { border-color: var(--accent); }
  .photo-slot img { width: 100%; height: 100%; object-fit: cover; }
  .photo-slot .plus { color: var(--text2); font-size: 24px; }
  .photo-slot .remove {
    position: absolute; top: 2px; right: 2px; background: rgba(0,0,0,0.7);
    color: #fff; border: none; border-radius: 50%; width: 20px; height: 20px;
    font-size: 12px; cursor: pointer; display: flex; align-items: center;
    justify-content: center;
  }
  .photos label { color: var(--text2); font-size: 13px; }

  .input-section { margin-bottom: 32px; }
  .input-section label {
    display: block; margin-bottom: 8px; font-weight: 600;
    font-family: 'Space Grotesk', sans-serif; font-size: 14px;
  }
  textarea {
    width: 100%; min-height: 160px; background: var(--surface);
    border: 1px solid var(--border); color: var(--text);
    padding: 16px; border-radius: 12px; font-size: 14px;
    font-family: 'DM Sans', sans-serif; resize: vertical;
    line-height: 1.6;
  }
  textarea::placeholder { color: var(--text2); }
  textarea:focus { outline: none; border-color: var(--accent); }

  .generate-row { display: flex; gap: 12px; margin-bottom: 32px; flex-wrap: wrap; }
  .btn {
    padding: 12px 24px; border-radius: 10px; border: none;
    font-family: 'Space Grotesk', sans-serif; font-weight: 600;
    font-size: 14px; cursor: pointer; transition: all 0.15s;
  }
  .btn:active { transform: scale(0.97); }
  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover { background: #c42520; }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
  .btn-secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
  .btn-secondary:hover { background: var(--border); }
  .btn-ghost { background: transparent; color: var(--text2); }
  .btn-ghost:hover { color: var(--text); }

  .results { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  @media (max-width: 768px) { .results { grid-template-columns: 1fr; } }

  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 16px; padding: 20px; position: relative;
  }
  .card h3 {
    font-size: 14px; color: var(--text2); margin-bottom: 16px;
    text-transform: uppercase; letter-spacing: 0.5px;
  }

  .thumbnail-grid { display: flex; flex-direction: column; gap: 16px; }
  .thumbnail-item {
    border-radius: 12px; overflow: hidden; position: relative;
    aspect-ratio: 16/9; background: var(--surface2);
    display: flex; align-items: center; justify-content: center;
  }
  .thumbnail-item img { width: 100%; height: 100%; object-fit: cover; }
  .thumbnail-item .loading {
    color: var(--text2); font-size: 13px; text-align: center;
  }
  .thumbnail-actions {
    display: flex; gap: 8px; margin-top: 8px;
  }

  .title-list { display: flex; flex-direction: column; gap: 8px; }
  .title-item {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 16px; background: var(--surface2);
    border-radius: 10px; cursor: pointer; transition: background 0.15s;
  }
  .title-item:hover { background: var(--border); }
  .title-item .num {
    font-family: 'Space Grotesk', sans-serif; font-weight: 700;
    color: var(--accent); font-size: 13px; min-width: 20px;
  }
  .title-item .text { font-size: 14px; flex: 1; line-height: 1.4; }
  .title-item .copy-icon { color: var(--text2); font-size: 12px; }

  .description-box {
    background: var(--surface2); border-radius: 10px;
    padding: 16px; font-size: 13px; line-height: 1.7;
    white-space: pre-wrap; color: var(--text); min-height: 200px;
    position: relative;
  }
  .description-box .copy-btn {
    position: absolute; top: 8px; right: 8px;
  }

  .prompt-preview {
    margin-top: 12px; padding: 12px; background: var(--surface2);
    border-radius: 8px; font-size: 11px; color: var(--text2);
    max-height: 100px; overflow-y: auto; white-space: pre-wrap;
  }

  .spinner {
    display: inline-block; width: 16px; height: 16px;
    border: 2px solid var(--border); border-top-color: var(--accent);
    border-radius: 50%; animation: spin 0.6s linear infinite;
    margin-right: 8px; vertical-align: middle;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .toast {
    position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
    background: var(--surface2); color: var(--green); padding: 10px 20px;
    border-radius: 8px; font-size: 13px; z-index: 100;
    border: 1px solid var(--border);
    animation: fadeInUp 0.2s ease-out;
  }
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateX(-50%) translateY(10px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
  }

  .card.full { grid-column: 1 / -1; }

  .style-chips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
  .chip {
    padding: 6px 14px; border-radius: 20px; font-size: 12px;
    background: var(--surface2); border: 1px solid var(--border);
    cursor: pointer; transition: all 0.15s; color: var(--text2);
  }
  .chip.active { background: var(--accent-glow); border-color: var(--accent); color: var(--accent); }
  .chip:hover { border-color: var(--text2); }

  /* Channel info panel */
  .channel-info {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 16px; margin-bottom: 32px;
    display: flex; gap: 16px; align-items: center; flex-wrap: wrap;
  }
  .channel-info .avatar {
    width: 48px; height: 48px; border-radius: 50%; background: var(--accent-glow);
    display: flex; align-items: center; justify-content: center; font-size: 24px;
    flex-shrink: 0;
  }
  .channel-info .meta { flex: 1; min-width: 200px; }
  .channel-info .meta h4 { font-size: 15px; margin-bottom: 2px; }
  .channel-info .meta p { color: var(--text2); font-size: 12px; line-height: 1.5; }
  .channel-info .edit-btn { align-self: flex-start; }

  /* Editable channel bio */
  .bio-editor {
    width: 100%; min-height: 80px; background: var(--surface2);
    border: 1px solid var(--border); color: var(--text);
    padding: 12px; border-radius: 8px; font-size: 12px;
    font-family: 'DM Sans', sans-serif; resize: vertical;
    line-height: 1.5; display: none;
  }
  .bio-editor.show { display: block; margin-top: 12px; }
</style>
</head>
<body>
<!-- Password Gate -->
<div id="authGate" style="display:flex;align-items:center;justify-content:center;min-height:100vh;flex-direction:column;gap:16px;">
  <div class="dot" style="width:12px;height:12px;border-radius:50%;background:var(--accent);margin-bottom:8px;"></div>
  <h2 style="font-family:'Space Grotesk',sans-serif;font-size:20px;">YT Toolkit</h2>
  <p style="color:var(--text2);font-size:13px;">Enter password to continue</p>
  <input type="password" id="passInput" placeholder="Password" style="background:var(--surface);border:1px solid var(--border);color:var(--text);padding:12px 20px;border-radius:10px;font-size:15px;font-family:'DM Sans',sans-serif;width:260px;text-align:center;" onkeydown="if(event.key==='Enter')checkPass()" autofocus />
  <button class="btn btn-primary" onclick="checkPass()" style="width:260px;">Enter</button>
  <p id="passError" style="color:var(--accent);font-size:12px;display:none;">Wrong password</p>
</div>

<div class="app" id="mainApp" style="display:none;">
  <!-- Header -->
  <div class="header">
    <div class="dot"></div>
    <h1>YT Toolkit</h1>
    <span>The Appiarist ‚Äî @thepawelk</span>
  </div>

  <!-- Channel Info -->
  <div class="channel-info">
    <div class="avatar">üêù</div>
    <div class="meta">
      <h4>The Appiarist ‚Äî @thepawelk</h4>
      <p id="channelBioPreview">React Native indie hacker building a hive of apps. Self-taught dev since 2017. Built and shipped 12+ apps (sold 2 on Flippa). Based in Poland. Building in public ‚Äî real revenue, real failures, no guru BS.</p>
    </div>
    <button class="btn btn-ghost edit-btn" onclick="toggleBioEditor()">Edit Bio</button>
  </div>
  <textarea class="bio-editor" id="bioEditor" placeholder="Edit your channel bio / about section. This context is used to write better descriptions."></textarea>

  <!-- API Keys -->
  <div class="setup">
    <input type="password" id="openaiKey" placeholder="OpenAI API key (sk-...)" />
    <input type="password" id="geminiKey" placeholder="Google Gemini API key" />
    <button class="btn btn-secondary" onclick="saveKeys()">Save Keys</button>
    <span class="key-saved" id="keySaved" style="display:none">‚úì Saved</span>
  </div>
  <p style="color:var(--text2);font-size:11px;margin-top:-24px;margin-bottom:24px;">Thumbnails use Gemini 2.5 Flash Image (nano-banana). Get a free API key at <a href="https://aistudio.google.com/apikey" target="_blank" style="color:var(--accent)">aistudio.google.com/apikey</a></p>

  <!-- Photos -->
  <div class="photos">
    <label>Your photos:</label>
    <div class="photo-slot" id="photo1" onclick="uploadPhoto(0)">
      <span class="plus">+</span>
    </div>
    <div class="photo-slot" id="photo2" onclick="uploadPhoto(1)">
      <span class="plus">+</span>
    </div>
    <input type="file" id="photoInput" accept="image/*" style="display:none" />
    <span style="color:var(--text2);font-size:12px">Upload 1-2 photos for thumbnail reference</span>
  </div>

  <!-- Input -->
  <div class="input-section">
    <label>Video Topic / Transcript / Summary</label>
    <textarea id="topicInput" placeholder="Paste your video transcript, topic description, or a brief summary of what the video is about..."></textarea>
  </div>

  <!-- Thumbnail style -->
  <div class="input-section">
    <label>Thumbnail Style</label>
    <div class="style-chips">
      <div class="chip active" data-style="bold-text">Bold Text + Face</div>
      <div class="chip" data-style="before-after">Before / After</div>
      <div class="chip" data-style="screenshot">App Screenshot</div>
      <div class="chip" data-style="minimal">Minimal / Clean</div>
      <div class="chip" data-style="cinematic">Cinematic</div>
      <div class="chip" data-style="meme">Meme / Reaction</div>
    </div>
  </div>

  <!-- Generate -->
  <div class="generate-row">
    <button class="btn btn-primary" id="generateAll" onclick="generateAll()">Generate All</button>
    <button class="btn btn-secondary" onclick="generateTitles()">Titles Only</button>
    <button class="btn btn-secondary" onclick="generateDescription()">Description Only</button>
    <button class="btn btn-secondary" onclick="generateThumbnail()">Thumbnail Only</button>
  </div>

  <!-- Results -->
  <div class="results">
    <!-- Titles -->
    <div class="card">
      <h3>üìù Title Options</h3>
      <div class="title-list" id="titleResults">
        <div style="color:var(--text2);font-size:13px;">Generate to see title suggestions</div>
      </div>
    </div>

    <!-- Thumbnail -->
    <div class="card">
      <h3>üé® Thumbnail</h3>
      <div class="thumbnail-grid" id="thumbnailResults">
        <div class="thumbnail-item">
          <div class="loading">Generate to create thumbnails</div>
        </div>
      </div>
      <div id="thumbnailPrompt"></div>
    </div>

    <!-- Description -->
    <div class="card full">
      <h3>üìÑ Description</h3>
      <div class="description-box" id="descriptionResults">
        Generate to see description
      </div>
    </div>
  </div>
</div>

<script>
// ============================================================================
// AUTH
// ============================================================================
function checkPass() {
  const input = document.getElementById('passInput').value;
  if (input === 'theappiarist321') {
    sessionStorage.setItem('yt_auth', '1');
    showApp();
  } else {
    const err = document.getElementById('passError');
    err.style.display = 'block';
    document.getElementById('passInput').value = '';
    document.getElementById('passInput').focus();
    setTimeout(() => err.style.display = 'none', 2000);
  }
}

function showApp() {
  document.getElementById('authGate').style.display = 'none';
  document.getElementById('mainApp').style.display = 'block';
}

if (sessionStorage.getItem('yt_auth') === '1') {
  window.addEventListener('DOMContentLoaded', showApp);
}

// ============================================================================
// CHANNEL CONTEXT
// ============================================================================
const CHANNEL = {
  name: "The Appiarist",
  handle: "@thepawelk",
  creator: "Pawe≈Ç Karniej",
  tagline: "Building a hive of apps",
  bio: `I'm building a hive of apps ‚Äî small projects, experiments, and products that compound over time.

Self-taught React Native developer since 2017. Based in Bia≈Çystok, Poland. I've built and shipped 12+ apps to the App Store ‚Äî sold 2 on Flippa, retired 2, and keep building new ones.

Current projects:
‚Ä¢ ShipReactNative ‚Äî React Native boilerplate with AI, payments, auth ($199)
‚Ä¢ Splonk ‚Äî macOS app for recording & editing app demos
‚Ä¢ GhostCommand ‚Äî voice-to-command macOS menu bar app
‚Ä¢ Newsletterytics ‚Äî newsletter analytics for Beehiiv & Mailchimp
‚Ä¢ YapperX ‚Äî voice memos ‚Üí tweets in your tone
‚Ä¢ Voxdrop ‚Äî AI-powered streamer donations (songs + voice drops)

My approach: Ship fast, be honest about what works and what doesn't, automate what you can, and keep building. I use AI and automation heavily ‚Äî including a personal AI assistant (CloudBot) that manages projects through Telegram.

I talk about: React Native, indie hacking, shipping apps, real revenue, AI-powered development, automation, and the vibecoding era.`,
  apps: [
    "Newsletterytics (newsletter analytics)",
    "YapperX (voice ‚Üí tweets)",
    "BeatAI (AI music practice)",
    "TeleprompterX (teleprompter)",
    "MoonLatte (caffeine tracking)",
    "VidNotes (video notes)",
    "Coldsmith (cold exposure tracking)",
    "FIFTN (focus timer)",
    "AIVidly (sold on Flippa)",
    "Rhava/Bibleily (sold on Flippa)",
  ],
  links: {
    twitter: "https://x.com/pawelkarniej",
    website: "https://pawelkarniej.com",
    boilerplate: "https://shipreactnative.com",
    linkedin: "https://linkedin.com/in/pawelkarniej",
    github: "https://github.com/Karniej",
  }
};

// ============================================================================
// BIO EDITOR
// ============================================================================
function toggleBioEditor() {
  const editor = document.getElementById('bioEditor');
  const isShowing = editor.classList.contains('show');
  if (isShowing) {
    const val = editor.value.trim();
    if (val) {
      CHANNEL.bio = val;
      localStorage.setItem('yt_channel_bio', val);
      document.getElementById('channelBioPreview').textContent = val.substring(0, 200) + (val.length > 200 ? '...' : '');
    }
    editor.classList.remove('show');
  } else {
    editor.value = localStorage.getItem('yt_channel_bio') || CHANNEL.bio;
    editor.classList.add('show');
    editor.focus();
  }
}

// ============================================================================
// STATE
// ============================================================================
let photos = [null, null];
let currentPhotoIndex = 0;

// ============================================================================
// KEYS
// ============================================================================
function saveKeys() {
  const ok = document.getElementById('openaiKey').value.trim();
  const gk = document.getElementById('geminiKey').value.trim();
  if (ok) localStorage.setItem('yt_openai_key', ok);
  if (gk) localStorage.setItem('yt_gemini_key', gk);
  const el = document.getElementById('keySaved');
  el.style.display = 'inline';
  setTimeout(() => el.style.display = 'none', 2000);
}

function getKey(name) {
  return localStorage.getItem(`yt_${name}_key`) || '';
}

// Gemini 2.5 Flash Image (nano-banana) for thumbnail generation
async function callGeminiImage(prompt) {
  const key = getKey('gemini');
  if (!key) { alert('Please enter your Google Gemini API key'); return null; }

  const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image:generateContent?key=${key}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      contents: [{
        parts: [{ text: prompt }]
      }],
      generationConfig: {
        responseModalities: ['TEXT', 'IMAGE'],
      }
    })
  });

  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    throw new Error(`Gemini error: ${err?.error?.message || res.statusText}`);
  }

  const data = await res.json();
  const parts = data?.candidates?.[0]?.content?.parts || [];
  
  // Find the image part
  for (const part of parts) {
    if (part.inlineData) {
      return `data:${part.inlineData.mimeType};base64,${part.inlineData.data}`;
    }
  }
  throw new Error('No image returned from Gemini. Try a different prompt.');
}

window.addEventListener('DOMContentLoaded', () => {
  const ok = getKey('openai');
  const gk = getKey('gemini');
  if (ok) document.getElementById('openaiKey').value = ok;
  if (gk) document.getElementById('geminiKey').value = gk;

  for (let i = 0; i < 2; i++) {
    const saved = localStorage.getItem(`yt_photo_${i}`);
    if (saved) { photos[i] = saved; renderPhoto(i); }
  }

  const savedBio = localStorage.getItem('yt_channel_bio');
  if (savedBio) {
    CHANNEL.bio = savedBio;
    document.getElementById('channelBioPreview').textContent = savedBio.substring(0, 200) + (savedBio.length > 200 ? '...' : '');
  }
});

// ============================================================================
// PHOTOS
// ============================================================================
function uploadPhoto(index) {
  if (photos[index]) return;
  currentPhotoIndex = index;
  document.getElementById('photoInput').click();
}

document.getElementById('photoInput')?.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    photos[currentPhotoIndex] = ev.target.result;
    localStorage.setItem(`yt_photo_${currentPhotoIndex}`, ev.target.result);
    renderPhoto(currentPhotoIndex);
  };
  reader.readAsDataURL(file);
  e.target.value = '';
});

function renderPhoto(index) {
  const el = document.getElementById(`photo${index + 1}`);
  if (photos[index]) {
    el.innerHTML = `<img src="${photos[index]}" /><button class="remove" onclick="event.stopPropagation();removePhoto(${index})">√ó</button>`;
  } else {
    el.innerHTML = '<span class="plus">+</span>';
  }
}

function removePhoto(index) {
  photos[index] = null;
  localStorage.removeItem(`yt_photo_${index}`);
  renderPhoto(index);
}

// ============================================================================
// STYLE CHIPS
// ============================================================================
document.querySelectorAll('.chip').forEach(chip => {
  chip.addEventListener('click', () => {
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
  });
});

function getSelectedStyle() {
  return document.querySelector('.chip.active')?.dataset.style || 'bold-text';
}

// ============================================================================
// OPENAI CALLS
// ============================================================================
async function callOpenAI(messages, temperature = 0.9, max_tokens = 2000) {
  const key = getKey('openai');
  if (!key) { alert('Please enter your OpenAI API key'); return null; }

  const res = await fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${key}` },
    body: JSON.stringify({ model: 'gpt-4o-mini', messages, temperature, max_tokens })
  });

  if (!res.ok) throw new Error(`OpenAI error: ${await res.text()}`);
  const data = await res.json();
  return data.choices[0].message.content;
}

// ============================================================================
// GENERATE TITLES
// ============================================================================
async function generateTitles() {
  const topic = document.getElementById('topicInput').value.trim();
  if (!topic) { alert('Please enter a topic or transcript'); return; }

  const el = document.getElementById('titleResults');
  el.innerHTML = '<div><span class="spinner"></span> Generating titles...</div>';

  try {
    const result = await callOpenAI([
      { role: 'system', content: `You write YouTube titles for "${CHANNEL.name}" (${CHANNEL.handle}), run by ${CHANNEL.creator}.

About the channel:
${CHANNEL.bio}

TITLE RULES:
- Max 60 characters (hard limit ‚Äî YouTube truncates)
- Create a curiosity gap. The viewer should NEED to click.
- Use contrast, tension, or unexpected juxtapositions
- Numbers work when they feel real ("$847/mo", "in 11 days", "4 failed apps")
- Power words: "actually", "real", "stopped", "broke", "failed", "accidentally", "quietly"
- Contrarian > conventional. Challenge assumptions.
- Talk like a real person, not a marketing playbook
- NO all-caps titles, NO excessive punctuation, NO "you won't believe"
- NO generic guru titles like "How to 10x Your Productivity"

GOOD EXAMPLES:
- "I Let an AI Bot Run My Business for a Week"
- "My App Made $0 for 6 Months. Then This Happened."
- "I Sold 2 Apps on Flippa. Here's What I Learned."
- "Stop Asking for Permission to Ship"
- "React Native is Dead (I Still Use It)"
- "I Automated My Dev Workflow Through Telegram"

BAD EXAMPLES:
- "How to Build Apps Fast" (boring, generic)
- "ULTIMATE Guide to React Native" (guru energy)
- "You NEED to Try This!!!" (clickbait)

Return exactly 10 titles, numbered 1-10. No quotes. Mix styles: some provocative, some honest, some curiosity-driven.` },
      { role: 'user', content: `Generate 10 YouTube titles for this video:\n\n${topic}` }
    ]);

    const titles = result.split('\n').filter(l => l.trim()).map(l => l.replace(/^\d+[\.\)]\s*/, '').replace(/^["']|["']$/g, ''));
    el.innerHTML = titles.map((t, i) =>
      `<div class="title-item" onclick="copyText(\`${t.replace(/`/g, '\\`')}\`)">
        <span class="num">${i + 1}</span>
        <span class="text">${t}</span>
        <span class="copy-icon">üìã</span>
      </div>`
    ).join('');
  } catch (err) {
    el.innerHTML = `<div style="color:var(--accent)">${err.message}</div>`;
  }
}

// ============================================================================
// GENERATE DESCRIPTION
// ============================================================================
async function generateDescription() {
  const topic = document.getElementById('topicInput').value.trim();
  if (!topic) { alert('Please enter a topic or transcript'); return; }

  const el = document.getElementById('descriptionResults');
  el.innerHTML = '<span class="spinner"></span> Generating description...';

  try {
    const result = await callOpenAI([
      { role: 'system', content: `You write YouTube descriptions for "${CHANNEL.name}" (${CHANNEL.handle}), run by ${CHANNEL.creator}.

CHANNEL CONTEXT:
${CHANNEL.bio}

DESCRIPTION FORMAT ‚Äî follow this structure exactly:

[Opening paragraph: 2-3 sentences that hook and summarize. Write in first person. Conversational, like you're telling a friend what happened. Front-load keywords naturally.]

[What I cover in this video ‚Äî use bullet points with "‚Ä¢" character:]
‚Ä¢ point one
‚Ä¢ point two
‚Ä¢ point three
‚Ä¢ etc.

[Optional: 1-2 sentence takeaway or call-to-action that feels natural, not salesy]

‚∏ª

üêù About The Appiarist
I'm building a hive of apps ‚Äî small projects, experiments, and products that compound over time.

‚∏ª

üîó Links
‚Ä¢ üåê ShipReactNative: ${CHANNEL.links.boilerplate}
‚Ä¢ üê¶ X / Twitter: ${CHANNEL.links.twitter}
‚Ä¢ üíº LinkedIn: ${CHANNEL.links.linkedin}
‚Ä¢ üåç Website: ${CHANNEL.links.website}

‚∏ª

üè∑Ô∏è Tags
[5-8 lowercase comma-separated tags relevant to the video]

STYLE RULES:
- First person, conversational, honest
- No em dashes (use "‚Äî" sparingly or rewrite)
- No corporate speak, no "in this video I'll show you how to..."
- The opening should feel like a real person talking
- Bullet points should be specific, not vague
- Include relevant keywords naturally (React Native, indie dev, etc.)
- First 150 chars matter most (shown in search)
- DO NOT include timestamps (the creator adds those later)
- Keep the energy real ‚Äî if the video is about failure, own it

REFERENCE STYLE (this is the vibe to match):
"In this video, I'm sharing an experiment I've been running with CloudBot ‚Äî using it to manage and code projects directly through Telegram. I gave it a separate email account, a separate GitHub account, and controlled access to my setup. Now I can move projects forward even when I'm not at my laptop."` },
      { role: 'user', content: `Write a YouTube description for this video:\n\n${topic}` }
    ], 0.7);

    el.innerHTML = result + `<button class="btn btn-ghost copy-btn" onclick="copyText(document.getElementById('descriptionResults').innerText)">Copy</button>`;
  } catch (err) {
    el.innerHTML = `<div style="color:var(--accent)">${err.message}</div>`;
  }
}

// ============================================================================
// GENERATE THUMBNAIL (DALL-E 3)
// ============================================================================
async function generateThumbnail() {
  const topic = document.getElementById('topicInput').value.trim();
  if (!topic) { alert('Please enter a topic or transcript'); return; }

  const gKey = getKey('gemini');
  if (!gKey) { alert('Please enter your Google Gemini API key'); return; }

  const el = document.getElementById('thumbnailResults');
  const promptEl = document.getElementById('thumbnailPrompt');
  el.innerHTML = '<div class="thumbnail-item"><div class="loading"><span class="spinner"></span> Creating thumbnail concept...</div></div>';

  const style = getSelectedStyle();

  try {
    // Step 1: Generate thumbnail text (2-4 punchy words)
    el.innerHTML = '<div class="thumbnail-item"><div class="loading"><span class="spinner"></span> Creating thumbnail concept...</div></div>';

    const thumbTextResult = await callOpenAI([
      { role: 'system', content: `You write thumbnail text for YouTube videos. Output ONLY 2-4 punchy words that create curiosity. These get overlaid as big bold text on a thumbnail.

Rules:
- MAX 4 words. Ideally 2-3.
- Create tension, curiosity, or emotion
- Use contrast: "$0 ‚Üí $10K", "BROKE IT", "IT WORKS", "never again"
- All caps or mixed case ‚Äî whatever hits harder
- NO full sentences. NO clickbait like "YOU WON'T BELIEVE"

Good: "I MASS I SHIPPED IT", "$0 REVENUE", "IT'S DEAD", "SOLD MY APP", "AI CODES NOW"
Bad: "How To Build Apps Faster" (too long, boring)

Return ONLY the text. Nothing else.` },
      { role: 'user', content: topic.substring(0, 300) }
    ], 1.0);

    const thumbText = thumbTextResult.trim().replace(/^["']|["']$/g, '');

    // Step 2: Generate clean background with Gemini
    const bgPrompt = await callOpenAI([
      { role: 'system', content: `You create image prompts for YouTube thumbnail BACKGROUNDS. The creator will composite their face photo on top, so DO NOT include any people, faces, or hands.

Style: "${style}"

RULES:
- Clean, simple background that supports the topic
- NO people, NO faces, NO hands, NO text
- Bold colors, high contrast, slightly blurred/gradient feel
- Think: solid gradients, abstract shapes, subtle code/tech elements, neon accents
- Dark backgrounds work best (the face photo and white text go on top)
- For "minimal": solid dark gradient with subtle accent color
- For "cinematic": moody dark with light rays or bokeh
- For "screenshot": dark desk/workspace setting, no person
- For "before-after": split background, dark left / bright right
- For "bold-text": dramatic gradient or abstract pattern
- For "meme": bright/chaotic background, emojis or icons floating
- Keep it SIMPLE. The face and text are the stars, not the background.

Output ONLY the prompt. 1-2 sentences. No explanation.` },
      { role: 'user', content: `Background for a video about: ${topic.substring(0, 300)}` }
    ], 0.8);

    promptEl.innerHTML = `<div class="prompt-preview">BG: ${bgPrompt}<br/>Text: ${thumbText}</div>`;

    el.innerHTML = '<div class="thumbnail-item"><div class="loading"><span class="spinner"></span> Generating background with nano-banana...</div></div>';

    const bgDataUrl = await callGeminiImage(bgPrompt);

    // Step 3: Composite face + background + text in canvas
    const canvas = document.createElement('canvas');
    canvas.width = 1280;
    canvas.height = 720;
    const ctx = canvas.getContext('2d');

    // Draw background
    const bgImg = new Image();
    bgImg.crossOrigin = 'anonymous';
    await new Promise((resolve, reject) => {
      bgImg.onload = resolve;
      bgImg.onerror = reject;
      bgImg.src = bgDataUrl;
    });
    ctx.drawImage(bgImg, 0, 0, 1280, 720);

    // Draw face photo (if uploaded) on the left side
    const faceData = photos[0] || photos[1];
    if (faceData) {
      const faceImg = new Image();
      await new Promise((resolve, reject) => {
        faceImg.onload = resolve;
        faceImg.onerror = reject;
        faceImg.src = faceData;
      });
      // Position face on left ~40% of frame, bottom-aligned
      const faceH = 720;
      const faceW = (faceImg.width / faceImg.height) * faceH;
      const faceX = -faceW * 0.1; // slightly off-left
      ctx.drawImage(faceImg, faceX, 0, faceW, faceH);
    }

    // Draw text overlay ‚Äî right side, big bold white with black stroke
    if (thumbText) {
      const lines = thumbText.length > 12 ? thumbText.split(/\s+/).reduce((acc, word) => {
        const last = acc[acc.length - 1];
        if (last && (last + ' ' + word).length <= 14) {
          acc[acc.length - 1] = last + ' ' + word;
        } else {
          acc.push(word);
        }
        return acc;
      }, []) : [thumbText];

      const fontSize = lines.length > 2 ? 80 : lines.length > 1 ? 100 : 120;
      ctx.font = `900 ${fontSize}px "Space Grotesk", "Arial Black", Impact, sans-serif`;
      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';

      const textX = 1230;
      const totalH = lines.length * (fontSize * 1.15);
      const startY = (720 - totalH) / 2 + fontSize / 2;

      lines.forEach((line, i) => {
        const y = startY + i * (fontSize * 1.15);
        // Black stroke
        ctx.strokeStyle = '#000';
        ctx.lineWidth = fontSize * 0.12;
        ctx.lineJoin = 'round';
        ctx.strokeText(line, textX, y);
        // White fill
        ctx.fillStyle = '#fff';
        ctx.fillText(line, textX, y);
      });
    }

    const finalDataUrl = canvas.toDataURL('image/jpeg', 0.95);

    el.innerHTML = `
      <div class="thumbnail-item">
        <img src="${finalDataUrl}" alt="Generated thumbnail" />
      </div>
      <div class="thumbnail-actions">
        <a href="${finalDataUrl}" download="thumbnail.jpg" class="btn btn-secondary" style="text-decoration:none;font-size:12px;">Download</a>
        <button class="btn btn-ghost" style="font-size:12px;" onclick="generateThumbnail()">Regenerate</button>
      </div>`;
  } catch (err) {
    el.innerHTML = `<div class="thumbnail-item"><div class="loading" style="color:var(--accent)">${err.message}</div></div>`;
  }
}

// ============================================================================
// GENERATE ALL
// ============================================================================
async function generateAll() {
  const btn = document.getElementById('generateAll');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Generating...';

  try {
    await Promise.all([
      generateTitles(),
      generateDescription(),
      generateThumbnail(),
    ]);
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'Generate All';
  }
}

// ============================================================================
// UTILS
// ============================================================================
function copyText(text) {
  navigator.clipboard.writeText(text).then(() => showToast('Copied to clipboard'));
}

function showToast(msg) {
  const existing = document.querySelector('.toast');
  if (existing) existing.remove();
  const el = document.createElement('div');
  el.className = 'toast';
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 2000);
}
</script>
</body>
</html>
