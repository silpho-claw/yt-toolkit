<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YT Toolkit ‚Äî The Appiarist</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #0a0a0a;
    --surface: #141414;
    --surface2: #1c1c1c;
    --border: #2a2a2a;
    --text: #f0f0f0;
    --text2: #888;
    --accent: #DD2B23;
    --accent-glow: rgba(221, 43, 35, 0.15);
    --green: #22c55e;
    --blue: #3b82f6;
    --yellow: #eab308;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  h1, h2, h3, h4 { font-family: 'Space Grotesk', sans-serif; }

  .app { max-width: 1200px; margin: 0 auto; padding: 24px; }

  .header {
    display: flex; align-items: center; gap: 16px;
    padding-bottom: 24px; border-bottom: 1px solid var(--border);
    margin-bottom: 32px;
  }
  .header h1 { font-size: 24px; font-weight: 700; }
  .header span { color: var(--text2); font-size: 14px; }
  .header .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent); }

  .setup {
    display: flex; gap: 12px; margin-bottom: 32px; flex-wrap: wrap;
  }
  .setup input, .setup select {
    background: var(--surface); border: 1px solid var(--border);
    color: var(--text); padding: 10px 14px; border-radius: 8px;
    font-size: 13px; font-family: 'DM Sans', sans-serif;
  }
  .setup input { flex: 1; min-width: 200px; }
  .setup input::placeholder { color: var(--text2); }
  .setup .key-saved { color: var(--green); font-size: 12px; align-self: center; }

  .photos {
    display: flex; gap: 12px; margin-bottom: 32px; align-items: center;
  }
  .photo-slot {
    width: 80px; height: 80px; border-radius: 12px;
    border: 2px dashed var(--border); display: flex;
    align-items: center; justify-content: center;
    cursor: pointer; overflow: hidden; position: relative;
    transition: border-color 0.2s;
  }
  .photo-slot:hover { border-color: var(--accent); }
  .photo-slot img { width: 100%; height: 100%; object-fit: cover; }
  .photo-slot .plus { color: var(--text2); font-size: 24px; }
  .photo-slot .remove {
    position: absolute; top: 2px; right: 2px; background: rgba(0,0,0,0.7);
    color: #fff; border: none; border-radius: 50%; width: 20px; height: 20px;
    font-size: 12px; cursor: pointer; display: flex; align-items: center;
    justify-content: center;
  }
  .photos label { color: var(--text2); font-size: 13px; }

  .input-section { margin-bottom: 32px; }
  .input-section label {
    display: block; margin-bottom: 8px; font-weight: 600;
    font-family: 'Space Grotesk', sans-serif; font-size: 14px;
  }
  textarea {
    width: 100%; min-height: 160px; background: var(--surface);
    border: 1px solid var(--border); color: var(--text);
    padding: 16px; border-radius: 12px; font-size: 14px;
    font-family: 'DM Sans', sans-serif; resize: vertical;
    line-height: 1.6;
  }
  textarea::placeholder { color: var(--text2); }
  textarea:focus { outline: none; border-color: var(--accent); }

  .generate-row { display: flex; gap: 12px; margin-bottom: 32px; flex-wrap: wrap; }
  .btn {
    padding: 12px 24px; border-radius: 10px; border: none;
    font-family: 'Space Grotesk', sans-serif; font-weight: 600;
    font-size: 14px; cursor: pointer; transition: all 0.15s;
  }
  .btn:active { transform: scale(0.97); }
  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover { background: #c42520; }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
  .btn-secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
  .btn-secondary:hover { background: var(--border); }
  .btn-ghost { background: transparent; color: var(--text2); }
  .btn-ghost:hover { color: var(--text); }

  .results { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  @media (max-width: 768px) { .results { grid-template-columns: 1fr; } }

  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 16px; padding: 20px; position: relative;
  }
  .card h3 {
    font-size: 14px; color: var(--text2); margin-bottom: 16px;
    text-transform: uppercase; letter-spacing: 0.5px;
  }

  .thumbnail-grid { display: flex; flex-direction: column; gap: 16px; }
  .thumbnail-item {
    border-radius: 12px; overflow: hidden; position: relative;
    aspect-ratio: 16/9; background: var(--surface2);
    display: flex; align-items: center; justify-content: center;
  }
  .thumbnail-item img { width: 100%; height: 100%; object-fit: cover; }
  .thumbnail-item .loading {
    color: var(--text2); font-size: 13px; text-align: center;
  }
  .thumbnail-actions {
    display: flex; gap: 8px; margin-top: 8px;
  }

  .title-list { display: flex; flex-direction: column; gap: 8px; }
  .title-item {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 16px; background: var(--surface2);
    border-radius: 10px; cursor: pointer; transition: background 0.15s;
  }
  .title-item:hover { background: var(--border); }
  .title-item .num {
    font-family: 'Space Grotesk', sans-serif; font-weight: 700;
    color: var(--accent); font-size: 13px; min-width: 20px;
  }
  .title-item .text { font-size: 14px; flex: 1; line-height: 1.4; }
  .title-item .copy-icon { color: var(--text2); font-size: 12px; }

  .description-box {
    background: var(--surface2); border-radius: 10px;
    padding: 16px; font-size: 13px; line-height: 1.7;
    white-space: pre-wrap; color: var(--text); min-height: 200px;
    position: relative;
  }
  .description-box .copy-btn {
    position: absolute; top: 8px; right: 8px;
  }

  .prompt-preview {
    margin-top: 12px; padding: 12px; background: var(--surface2);
    border-radius: 8px; font-size: 11px; color: var(--text2);
    max-height: 100px; overflow-y: auto; white-space: pre-wrap;
  }

  .spinner {
    display: inline-block; width: 16px; height: 16px;
    border: 2px solid var(--border); border-top-color: var(--accent);
    border-radius: 50%; animation: spin 0.6s linear infinite;
    margin-right: 8px; vertical-align: middle;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .toast {
    position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
    background: var(--surface2); color: var(--green); padding: 10px 20px;
    border-radius: 8px; font-size: 13px; z-index: 100;
    border: 1px solid var(--border);
    animation: fadeInUp 0.2s ease-out;
  }
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateX(-50%) translateY(10px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
  }

  .card.full { grid-column: 1 / -1; }

  .style-chips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
  .chip {
    padding: 6px 14px; border-radius: 20px; font-size: 12px;
    background: var(--surface2); border: 1px solid var(--border);
    cursor: pointer; transition: all 0.15s; color: var(--text2);
  }
  .chip.active { background: var(--accent-glow); border-color: var(--accent); color: var(--accent); }
  .chip:hover { border-color: var(--text2); }

  /* Channel info panel */
  .channel-info {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 16px; margin-bottom: 32px;
    display: flex; gap: 16px; align-items: center; flex-wrap: wrap;
  }
  .channel-info .avatar {
    width: 48px; height: 48px; border-radius: 50%; background: var(--accent-glow);
    display: flex; align-items: center; justify-content: center; font-size: 24px;
    flex-shrink: 0;
  }
  .channel-info .meta { flex: 1; min-width: 200px; }
  .channel-info .meta h4 { font-size: 15px; margin-bottom: 2px; }
  .channel-info .meta p { color: var(--text2); font-size: 12px; line-height: 1.5; }
  .channel-info .edit-btn { align-self: flex-start; }

  /* Editable channel bio */
  .bio-editor {
    width: 100%; min-height: 80px; background: var(--surface2);
    border: 1px solid var(--border); color: var(--text);
    padding: 12px; border-radius: 8px; font-size: 12px;
    font-family: 'DM Sans', sans-serif; resize: vertical;
    line-height: 1.5; display: none;
  }
  .bio-editor.show { display: block; margin-top: 12px; }
</style>
</head>
<body>
<!-- Password Gate -->
<div id="authGate" style="display:flex;align-items:center;justify-content:center;min-height:100vh;flex-direction:column;gap:16px;">
  <div class="dot" style="width:12px;height:12px;border-radius:50%;background:var(--accent);margin-bottom:8px;"></div>
  <h2 style="font-family:'Space Grotesk',sans-serif;font-size:20px;">YT Toolkit</h2>
  <p style="color:var(--text2);font-size:13px;">Enter password to continue</p>
  <input type="password" id="passInput" placeholder="Password" style="background:var(--surface);border:1px solid var(--border);color:var(--text);padding:12px 20px;border-radius:10px;font-size:15px;font-family:'DM Sans',sans-serif;width:260px;text-align:center;" onkeydown="if(event.key==='Enter')checkPass()" autofocus />
  <button class="btn btn-primary" onclick="checkPass()" style="width:260px;">Enter</button>
  <p id="passError" style="color:var(--accent);font-size:12px;display:none;">Wrong password</p>
</div>

<div class="app" id="mainApp" style="display:none;">
  <!-- Header -->
  <div class="header">
    <div class="dot"></div>
    <h1>YT Toolkit</h1>
    <span>The Appiarist ‚Äî @thepawelk</span>
  </div>

  <!-- Channel Info -->
  <div class="channel-info">
    <div class="avatar">üêù</div>
    <div class="meta">
      <h4>The Appiarist ‚Äî @thepawelk</h4>
      <p id="channelBioPreview">React Native indie hacker building a hive of apps. Self-taught dev since 2017. Built and shipped 12+ apps (sold 2 on Flippa). Based in Poland. Building in public ‚Äî real revenue, real failures, no guru BS.</p>
    </div>
    <button class="btn btn-ghost edit-btn" onclick="toggleBioEditor()">Edit Bio</button>
  </div>
  <textarea class="bio-editor" id="bioEditor" placeholder="Edit your channel bio / about section. This context is used to write better descriptions."></textarea>

  <!-- API Keys -->
  <div class="setup">
    <input type="password" id="openaiKey" placeholder="OpenAI API key (sk-...)" />
    <input type="password" id="geminiKey" placeholder="Google Gemini API key" />
    <button class="btn btn-secondary" onclick="saveKeys()">Save Keys</button>
    <span class="key-saved" id="keySaved" style="display:none">‚úì Saved</span>
  </div>
  <p style="color:var(--text2);font-size:11px;margin-top:-24px;margin-bottom:24px;">Thumbnails use Gemini 2.5 Flash Image (nano-banana). Get a free API key at <a href="https://aistudio.google.com/apikey" target="_blank" style="color:var(--accent)">aistudio.google.com/apikey</a></p>

  <!-- Photos -->
  <div class="photos" style="flex-wrap:wrap;">
    <div style="display:flex;flex-direction:column;align-items:center;gap:4px;">
      <div class="photo-slot" id="photo1" onclick="uploadPhoto(0)"><span class="plus">+</span></div>
      <span style="color:var(--text2);font-size:11px;">Your face</span>
    </div>
    <div style="display:flex;flex-direction:column;align-items:center;gap:4px;">
      <div class="photo-slot" id="photo2" onclick="uploadPhoto(1)"><span class="plus">+</span></div>
      <span style="color:var(--text2);font-size:11px;">Video frame</span>
    </div>
    <div id="extraPhotosContainer" style="display:flex;gap:12px;flex-wrap:wrap;"></div>
    <div style="display:flex;flex-direction:column;align-items:center;gap:4px;">
      <div class="photo-slot" onclick="addExtraPhoto()" style="border-style:dotted;"><span class="plus" style="font-size:18px;">+</span></div>
      <span style="color:var(--text2);font-size:11px;">Add image</span>
    </div>
    <input type="file" id="photoInput" accept="image/*" style="display:none" />
  </div>
  <p style="color:var(--text2);font-size:11px;margin-top:-20px;margin-bottom:24px;">Extra images (logos, screenshots, icons) get sent to Gemini to include in the thumbnail.</p>

  <!-- Input -->
  <div class="input-section">
    <label>Video Topic / Transcript / Summary</label>
    <textarea id="topicInput" placeholder="Paste your video transcript, topic description, or a brief summary of what the video is about..."></textarea>
  </div>

  <!-- Thumbnail controls -->
  <div class="input-section">
    <label>Thumbnail Text <button class="btn btn-ghost" style="font-size:12px;padding:4px 10px;margin-left:8px;" onclick="suggestThumbTexts()">‚ú® Suggest from topic</button></label>
    <input type="text" id="thumbTextInput" placeholder='e.g. "CLOUD BOT MAGIC!" or "I SHIPPED IT"' style="width:100%;background:var(--surface);border:1px solid var(--border);color:var(--text);padding:12px 16px;border-radius:10px;font-size:15px;font-family:'Space Grotesk',sans-serif;font-weight:700;" />
    <div id="thumbTextSuggestions" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;"></div>
  </div>

  <div class="input-section">
    <label>Text Tone</label>
    <div class="style-chips" id="textToneChips">
      <div class="chip active" data-tone="curiosity">Curiosity Gap</div>
      <div class="chip" data-tone="provocative">Provocative</div>
      <div class="chip" data-tone="honest">Honest / Raw</div>
      <div class="chip" data-tone="hype">Hype / Excited</div>
      <div class="chip" data-tone="deadpan">Deadpan / Dry</div>
      <div class="chip" data-tone="contrarian">Contrarian</div>
      <div class="chip" data-tone="numbers">Numbers / Data</div>
      <div class="chip" data-tone="question">Question</div>
    </div>
  </div>

  <div class="input-section">
    <label>Text Visual Style</label>
    <div class="style-chips" id="textStyleChips">
      <div class="chip active" data-textstyle="bold-white">Bold White + Black Outline</div>
      <div class="chip" data-textstyle="yellow-bold">Yellow Bold</div>
      <div class="chip" data-textstyle="red-highlight">Red Highlight Box</div>
      <div class="chip" data-textstyle="neon-glow">Neon Glow</div>
      <div class="chip" data-textstyle="gradient-text">Gradient Text</div>
      <div class="chip" data-textstyle="3d-text">3D / Drop Shadow</div>
      <div class="chip" data-textstyle="handwritten">Handwritten / Marker</div>
      <div class="chip" data-textstyle="glitch">Glitch / Distorted</div>
    </div>
  </div>

  <div class="input-section">
    <label>Layout Style</label>
    <div class="style-chips" id="layoutStyleChips">
      <div class="chip active" data-style="face-left-text-right">Face Left + Text Right</div>
      <div class="chip" data-style="face-center-text-top">Face Center + Text Top</div>
      <div class="chip" data-style="dramatic">Dramatic / Cinematic</div>
      <div class="chip" data-style="split">Split Screen</div>
      <div class="chip" data-style="podcast-style">Podcast / Talking Head</div>
      <div class="chip" data-style="face-with-icon">Face + Icon</div>
      <div class="chip" data-style="screenshot-reaction">Screenshot + Reaction</div>
      <div class="chip" data-style="breaking-news">Breaking News</div>
      <div class="chip" data-style="versus">VS / Versus</div>
      <div class="chip" data-style="ranking-list">Ranking List</div>
    </div>
  </div>

  <!-- Generate -->
  <div class="generate-row">
    <button class="btn btn-primary" id="generateAll" onclick="generateAll()">Generate All</button>
    <button class="btn btn-secondary" onclick="generateTitles()">Titles Only</button>
    <button class="btn btn-secondary" onclick="generateDescription()">Description Only</button>
    <button class="btn btn-secondary" onclick="generateThumbnail()">Thumbnail Only</button>
  </div>

  <!-- Results -->
  <div class="results">
    <!-- Titles -->
    <div class="card">
      <h3>üìù Title Options</h3>
      <div class="title-list" id="titleResults">
        <div style="color:var(--text2);font-size:13px;">Generate to see title suggestions</div>
      </div>
    </div>

    <!-- Thumbnail -->
    <div class="card">
      <h3>üé® Thumbnail</h3>
      <div class="thumbnail-grid" id="thumbnailResults">
        <div class="thumbnail-item">
          <div class="loading">Generate to create thumbnails</div>
        </div>
      </div>
      <div id="thumbnailPrompt"></div>
    </div>

    <!-- Description -->
    <div class="card full">
      <h3>üìÑ Description</h3>
      <div class="description-box" id="descriptionResults">
        Generate to see description
      </div>
    </div>
  </div>
</div>

<script>
// ============================================================================
// AUTH
// ============================================================================
function checkPass() {
  const input = document.getElementById('passInput').value;
  if (input === 'theappiarist321') {
    sessionStorage.setItem('yt_auth', '1');
    showApp();
  } else {
    const err = document.getElementById('passError');
    err.style.display = 'block';
    document.getElementById('passInput').value = '';
    document.getElementById('passInput').focus();
    setTimeout(() => err.style.display = 'none', 2000);
  }
}

function showApp() {
  document.getElementById('authGate').style.display = 'none';
  document.getElementById('mainApp').style.display = 'block';
}

if (sessionStorage.getItem('yt_auth') === '1') {
  window.addEventListener('DOMContentLoaded', showApp);
}

// ============================================================================
// CHANNEL CONTEXT
// ============================================================================
const CHANNEL = {
  name: "The Appiarist",
  handle: "@thepawelk",
  creator: "Pawe≈Ç Karniej",
  tagline: "Building a hive of apps",
  bio: `I'm building a hive of apps ‚Äî small projects, experiments, and products that compound over time.

Self-taught React Native developer since 2017. Based in Bia≈Çystok, Poland. I've built and shipped 12+ apps to the App Store ‚Äî sold 2 on Flippa, retired 2, and keep building new ones.

Current projects:
‚Ä¢ ShipReactNative ‚Äî React Native boilerplate with AI, payments, auth ($199)
‚Ä¢ Splonk ‚Äî macOS app for recording & editing app demos
‚Ä¢ GhostCommand ‚Äî voice-to-command macOS menu bar app
‚Ä¢ Newsletterytics ‚Äî newsletter analytics for Beehiiv & Mailchimp
‚Ä¢ YapperX ‚Äî voice memos ‚Üí tweets in your tone
‚Ä¢ Voxdrop ‚Äî AI-powered streamer donations (songs + voice drops)

My approach: Ship fast, be honest about what works and what doesn't, automate what you can, and keep building. I use AI and automation heavily ‚Äî including a personal AI assistant (CloudBot) that manages projects through Telegram.

I talk about: React Native, indie hacking, shipping apps, real revenue, AI-powered development, automation, and the vibecoding era.`,
  apps: [
    "Newsletterytics (newsletter analytics)",
    "YapperX (voice ‚Üí tweets)",
    "BeatAI (AI music practice)",
    "TeleprompterX (teleprompter)",
    "MoonLatte (caffeine tracking)",
    "VidNotes (video notes)",
    "Coldsmith (cold exposure tracking)",
    "FIFTN (focus timer)",
    "AIVidly (sold on Flippa)",
    "Rhava/Bibleily (sold on Flippa)",
  ],
  links: {
    twitter: "https://x.com/pawelkarniej",
    website: "https://pawelkarniej.com",
    boilerplate: "https://shipreactnative.com",
    linkedin: "https://linkedin.com/in/pawelkarniej",
    github: "https://github.com/Karniej",
  }
};

// ============================================================================
// BIO EDITOR
// ============================================================================
function toggleBioEditor() {
  const editor = document.getElementById('bioEditor');
  const isShowing = editor.classList.contains('show');
  if (isShowing) {
    const val = editor.value.trim();
    if (val) {
      CHANNEL.bio = val;
      localStorage.setItem('yt_channel_bio', val);
      document.getElementById('channelBioPreview').textContent = val.substring(0, 200) + (val.length > 200 ? '...' : '');
    }
    editor.classList.remove('show');
  } else {
    editor.value = localStorage.getItem('yt_channel_bio') || CHANNEL.bio;
    editor.classList.add('show');
    editor.focus();
  }
}

// ============================================================================
// STATE
// ============================================================================
let photos = [null, null];
let extraPhotos = []; // additional images (logos, screenshots, icons)
let currentPhotoIndex = 0;

// ============================================================================
// KEYS
// ============================================================================
function saveKeys() {
  const ok = document.getElementById('openaiKey').value.trim();
  const gk = document.getElementById('geminiKey').value.trim();
  if (ok) localStorage.setItem('yt_openai_key', ok);
  if (gk) localStorage.setItem('yt_gemini_key', gk);
  const el = document.getElementById('keySaved');
  el.style.display = 'inline';
  setTimeout(() => el.style.display = 'none', 2000);
}

function getKey(name) {
  return localStorage.getItem(`yt_${name}_key`) || '';
}

// Gemini 2.5 Flash Image (nano-banana) for thumbnail generation
// Supports optional input image (face photo) that gets incorporated
async function callGeminiImage(prompt, inputImageBase64 = null, secondImageBase64 = null, additionalImages = []) {
  const key = getKey('gemini');
  if (!key) { alert('Please enter your Google Gemini API key'); return null; }

  const parts = [];

  function addImage(dataUrl) {
    const match = dataUrl.match(/^data:([^;]+);base64,(.+)$/);
    if (match) parts.push({ inlineData: { mimeType: match[1], data: match[2] } });
  }

  if (inputImageBase64) addImage(inputImageBase64);
  if (secondImageBase64) addImage(secondImageBase64);
  additionalImages.forEach(img => addImage(img));

  parts.push({ text: prompt });

  const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image:generateContent?key=${key}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      contents: [{ parts }],
      generationConfig: {
        responseModalities: ['TEXT', 'IMAGE'],
      }
    })
  });

  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    throw new Error(`Gemini error: ${err?.error?.message || res.statusText}`);
  }

  const data = await res.json();
  const responseParts = data?.candidates?.[0]?.content?.parts || [];
  
  for (const part of responseParts) {
    if (part.inlineData) {
      return `data:${part.inlineData.mimeType};base64,${part.inlineData.data}`;
    }
  }
  throw new Error('No image returned from Gemini. Try a different prompt.');
}

window.addEventListener('DOMContentLoaded', () => {
  const ok = getKey('openai');
  const gk = getKey('gemini');
  if (ok) document.getElementById('openaiKey').value = ok;
  if (gk) document.getElementById('geminiKey').value = gk;

  for (let i = 0; i < 2; i++) {
    const saved = localStorage.getItem(`yt_photo_${i}`);
    if (saved) { photos[i] = saved; renderPhoto(i); }
  }

  const savedBio = localStorage.getItem('yt_channel_bio');
  if (savedBio) {
    CHANNEL.bio = savedBio;
    document.getElementById('channelBioPreview').textContent = savedBio.substring(0, 200) + (savedBio.length > 200 ? '...' : '');
  }
});

// ============================================================================
// PHOTOS
// ============================================================================
function uploadPhoto(index) {
  if (photos[index]) return;
  currentPhotoIndex = index;
  document.getElementById('photoInput').click();
}

document.getElementById('photoInput')?.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    const img = new Image();
    img.onload = () => {
      const MAX = 800;
      let w = img.width, h = img.height;
      if (w > MAX || h > MAX) {
        if (w > h) { h = Math.round(h * MAX / w); w = MAX; }
        else { w = Math.round(w * MAX / h); h = MAX; }
      }
      const c = document.createElement('canvas');
      c.width = w; c.height = h;
      c.getContext('2d').drawImage(img, 0, 0, w, h);
      const compressed = c.toDataURL('image/jpeg', 0.7);
      if (currentPhotoIndex === -1) {
        // Extra photo
        extraPhotos.push(compressed);
        renderExtraPhotos();
      } else {
        photos[currentPhotoIndex] = compressed;
        try { localStorage.setItem(`yt_photo_${currentPhotoIndex}`, compressed); } catch(e) {}
        renderPhoto(currentPhotoIndex);
      }
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
  e.target.value = '';
});

function renderPhoto(index) {
  const el = document.getElementById(`photo${index + 1}`);
  if (photos[index]) {
    el.innerHTML = `<img src="${photos[index]}" /><button class="remove" onclick="event.stopPropagation();removePhoto(${index})">√ó</button>`;
  } else {
    el.innerHTML = '<span class="plus">+</span>';
  }
}

function removePhoto(index) {
  photos[index] = null;
  localStorage.removeItem(`yt_photo_${index}`);
  renderPhoto(index);
}

function addExtraPhoto() {
  currentPhotoIndex = -1; // signal for extra photo
  document.getElementById('photoInput').click();
}

function renderExtraPhotos() {
  const container = document.getElementById('extraPhotosContainer');
  container.innerHTML = extraPhotos.map((data, i) =>
    `<div style="display:flex;flex-direction:column;align-items:center;gap:4px;">
      <div class="photo-slot" style="position:relative;">
        <img src="${data}" style="width:100%;height:100%;object-fit:cover;" />
        <button class="remove" onclick="event.stopPropagation();removeExtraPhoto(${i})">√ó</button>
      </div>
      <span style="color:var(--text2);font-size:11px;">Extra ${i+1}</span>
    </div>`
  ).join('');
}

function removeExtraPhoto(index) {
  extraPhotos.splice(index, 1);
  renderExtraPhotos();
}

// ============================================================================
// STYLE CHIPS
// ============================================================================
// All chip groups: click toggles within parent only
document.querySelectorAll('#layoutStyleChips .chip, #textStyleChips .chip, #textToneChips .chip').forEach(chip => {
  chip.addEventListener('click', () => {
    chip.parentElement.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
  });
});

function getSelectedStyle() {
  return document.querySelector('#layoutStyleChips .chip.active')?.dataset.style || 'face-left-text-right';
}

function getSelectedTextStyle() {
  return document.querySelector('#textStyleChips .chip.active')?.dataset.textstyle || 'bold-white';
}

function getSelectedTone() {
  return document.querySelector('#textToneChips .chip.active')?.dataset.tone || 'curiosity';
}

// ============================================================================
// OPENAI CALLS
// ============================================================================
async function callOpenAI(messages, temperature = 0.9, max_tokens = 2000) {
  const key = getKey('openai');
  if (!key) { alert('Please enter your OpenAI API key'); return null; }

  const res = await fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${key}` },
    body: JSON.stringify({ model: 'gpt-4o-mini', messages, temperature, max_tokens })
  });

  if (!res.ok) throw new Error(`OpenAI error: ${await res.text()}`);
  const data = await res.json();
  return data.choices[0].message.content;
}

// ============================================================================
// SUGGEST THUMBNAIL TEXT
// ============================================================================
async function suggestThumbTexts() {
  const topic = document.getElementById('topicInput').value.trim();
  if (!topic) { alert('Enter a topic first'); return; }

  const el = document.getElementById('thumbTextSuggestions');
  el.innerHTML = '<span class="spinner"></span>';

  const tone = getSelectedTone();
  const toneInstructions = {
    'curiosity': 'Create a curiosity gap ‚Äî the viewer NEEDS to click to find out. Leave something unsaid. Examples: "IT HAPPENED", "WAIT WHAT", "THE SECRET"',
    'provocative': 'Be provocative and bold. Challenge assumptions. Make people angry or excited enough to click. Examples: "IT\'S DEAD", "STOP DOING THIS", "YOU\'RE WRONG"',
    'honest': 'Be raw and honest. No hype, just real talk. Vulnerability works. Examples: "$0 REVENUE", "I FAILED", "HONEST REVIEW", "THE TRUTH"',
    'hype': 'Maximum excitement and energy. Celebrate wins. Examples: "LET\'S GO!", "SHIPPED IT!", "IT WORKS!", "GAME CHANGER"',
    'deadpan': 'Dry, understated, slightly ironic humor. Examples: "oh no", "well then", "cool cool cool", "it broke"',
    'contrarian': 'Go against the popular opinion. Be the "actually..." voice. Examples: "OVERRATED", "NOBODY ASKED", "WRONG TAKE", "UNPOPULAR OPINION"',
    'numbers': 'Lead with a specific number or data point. Examples: "$847/MO", "10 APPS", "0 USERS", "3 MONTHS", "24 HOURS"',
    'question': 'Ask a compelling question that makes people want the answer. Examples: "IS IT WORTH IT?", "BUT WHY?", "WHO ASKED?", "REALLY?"',
  };

  try {
    const result = await callOpenAI([
      { role: 'system', content: `Generate 5 thumbnail text options for a YouTube video. Read the transcript/topic carefully and pull SPECIFIC words from the actual content.

TONE: ${toneInstructions[tone] || toneInstructions['curiosity']}

Rules:
- MAX 4 words per option, ALL CAPS
- Must reference something SPECIFIC from the video (a tool name, a number, a specific outcome)
- NO generic phrases that could apply to any video ("GAME CHANGER", "THIS IS IT", "MUST SEE")
- The text should make someone who watches the video think "yeah, that's what it's about"

Return exactly 5 options, one per line, numbered 1-5. Nothing else.` },
      { role: 'user', content: topic.substring(0, 500) }
    ], 1.0);

    const options = result.split('\n').filter(l => l.trim()).map(l => l.replace(/^\d+[\.\)]\s*/, '').replace(/^["']|["']$/g, '').trim());
    el.innerHTML = options.map(t =>
      `<div class="chip" onclick="document.getElementById('thumbTextInput').value='${t.replace(/'/g, "\\'")}';document.querySelectorAll('#thumbTextSuggestions .chip').forEach(c=>c.classList.remove('active'));this.classList.add('active')" style="cursor:pointer;font-weight:600;">${t}</div>`
    ).join('');
  } catch (err) {
    el.innerHTML = `<span style="color:var(--accent);font-size:12px">${err.message}</span>`;
  }
}

// ============================================================================
// GENERATE TITLES
// ============================================================================
async function generateTitles() {
  const topic = document.getElementById('topicInput').value.trim();
  if (!topic) { alert('Please enter a topic or transcript'); return; }

  const el = document.getElementById('titleResults');
  el.innerHTML = '<div><span class="spinner"></span> Generating titles...</div>';

  try {
    const result = await callOpenAI([
      { role: 'system', content: `You write YouTube titles for "${CHANNEL.name}" (${CHANNEL.handle}), run by ${CHANNEL.creator}.

About the channel:
${CHANNEL.bio}

YOUR JOB: Read the transcript/topic carefully and extract the ACTUAL content ‚Äî what specifically happened, what was built, what was learned. Titles must reflect the real video content, not generic clickbait.

TITLE RULES:
- Max 60 characters (YouTube truncates longer)
- Titles must be SPECIFIC to what the video actually covers
- Pull real details from the transcript: tool names, specific outcomes, actual numbers
- Talk like a real person describing what they did, not a marketing headline
- First person feels natural for this channel
- NO generic clickbait ("This Changes Everything", "You Won't Believe")
- NO vague titles that could apply to any video
- NO guru energy, NO hype words like "INSANE", "MIND-BLOWING", "GAME CHANGER"

GOOD (specific, grounded):
- "I Let a Telegram Bot Push Code to My Projects"
- "Upgrading ShipReactNative to Expo SDK 55"
- "Building 6 Apps at Once (Here's How I Stay Sane)"
- "My Newsletter App Now Supports Mailchimp"
- "I Sold My App on Flippa for $800"

BAD (generic, clickbaity):
- "This Tool Changes EVERYTHING" (vague, could be any video)
- "You NEED to See This!" (pure clickbait)
- "The Future of Coding is HERE" (guru energy)
- "How I 10x'd My Productivity" (generic)

Return exactly 10 titles, numbered 1-10. No quotes. Each must be clearly about the specific video topic.` },
      { role: 'user', content: `Generate 10 YouTube titles for this video:\n\n${topic}` }
    ]);

    const titles = result.split('\n').filter(l => l.trim()).map(l => l.replace(/^\d+[\.\)]\s*/, '').replace(/^["']|["']$/g, ''));
    el.innerHTML = titles.map((t, i) =>
      `<div class="title-item" onclick="copyText(\`${t.replace(/`/g, '\\`')}\`)">
        <span class="num">${i + 1}</span>
        <span class="text">${t}</span>
        <span class="copy-icon">üìã</span>
      </div>`
    ).join('');
  } catch (err) {
    el.innerHTML = `<div style="color:var(--accent)">${err.message}</div>`;
  }
}

// ============================================================================
// GENERATE DESCRIPTION
// ============================================================================
async function generateDescription() {
  const topic = document.getElementById('topicInput').value.trim();
  if (!topic) { alert('Please enter a topic or transcript'); return; }

  const el = document.getElementById('descriptionResults');
  el.innerHTML = '<span class="spinner"></span> Generating description...';

  try {
    const result = await callOpenAI([
      { role: 'system', content: `You write YouTube descriptions for "${CHANNEL.name}" (${CHANNEL.handle}), run by ${CHANNEL.creator}.

CHANNEL CONTEXT:
${CHANNEL.bio}

DESCRIPTION FORMAT ‚Äî follow this structure exactly:

[Opening paragraph: 2-3 sentences that hook and summarize. Write in first person. Conversational, like you're telling a friend what happened. Front-load keywords naturally.]

[What I cover in this video ‚Äî use bullet points with "‚Ä¢" character:]
‚Ä¢ point one
‚Ä¢ point two
‚Ä¢ point three
‚Ä¢ etc.

[Optional: 1-2 sentence takeaway or call-to-action that feels natural, not salesy]

‚∏ª

üêù About The Appiarist
I'm building a hive of apps ‚Äî small projects, experiments, and products that compound over time.

‚∏ª

üîó Links
‚Ä¢ üåê ShipReactNative: ${CHANNEL.links.boilerplate}
‚Ä¢ üê¶ X / Twitter: ${CHANNEL.links.twitter}
‚Ä¢ üíº LinkedIn: ${CHANNEL.links.linkedin}
‚Ä¢ üåç Website: ${CHANNEL.links.website}

‚∏ª

üè∑Ô∏è Tags
[5-8 lowercase comma-separated tags relevant to the video]

STYLE RULES:
- First person, conversational, honest
- No em dashes (use "‚Äî" sparingly or rewrite)
- No corporate speak, no "in this video I'll show you how to..."
- The opening should feel like a real person talking
- Bullet points should be specific, not vague
- Include relevant keywords naturally (React Native, indie dev, etc.)
- First 150 chars matter most (shown in search)
- DO NOT include timestamps (the creator adds those later)
- Keep the energy real ‚Äî if the video is about failure, own it

REFERENCE STYLE (this is the vibe to match):
"In this video, I'm sharing an experiment I've been running with CloudBot ‚Äî using it to manage and code projects directly through Telegram. I gave it a separate email account, a separate GitHub account, and controlled access to my setup. Now I can move projects forward even when I'm not at my laptop."` },
      { role: 'user', content: `Write a YouTube description for this video:\n\n${topic}` }
    ], 0.7);

    el.innerHTML = result + `<button class="btn btn-ghost copy-btn" onclick="copyText(document.getElementById('descriptionResults').innerText)">Copy</button>`;
  } catch (err) {
    el.innerHTML = `<div style="color:var(--accent)">${err.message}</div>`;
  }
}

// ============================================================================
// GENERATE THUMBNAIL (Gemini nano-banana)
// ============================================================================
async function generateThumbnail() {
  const topic = document.getElementById('topicInput').value.trim();
  if (!topic) { alert('Please enter a topic or transcript'); return; }

  const gKey = getKey('gemini');
  if (!gKey) { alert('Please enter your Google Gemini API key'); return; }

  const faceData = photos[0];
  if (!faceData) { alert('Upload your face photo first ‚Äî it gets used inside the thumbnail'); return; }

  const el = document.getElementById('thumbnailResults');
  const promptEl = document.getElementById('thumbnailPrompt');
  el.innerHTML = '<div class="thumbnail-item"><div class="loading"><span class="spinner"></span> Generating thumbnail with nano-banana...</div></div>';

  const style = getSelectedStyle();
  let thumbText = document.getElementById('thumbTextInput').value.trim();

  try {
    if (!thumbText) {
      alert('Enter thumbnail text or click "‚ú® Suggest from topic" first');
      return;
    }

    // Text style descriptions
    const textStyle = getSelectedTextStyle();
    const textStyleDesc = {
      'bold-white': 'very large, bold, white Impact-style font with a thick black outline',
      'yellow-bold': 'very large, bold, bright yellow font with a thick black outline, high contrast',
      'red-highlight': 'large bold white font inside a red rectangular highlight box, like a news chyron',
      'neon-glow': 'large bold font with a bright neon glow effect (cyan or green), glowing against the dark background',
      'gradient-text': 'very large bold font with a gradient fill from white to bright blue or orange, with subtle shadow',
      '3d-text': 'very large bold white 3D-style font with a strong drop shadow and depth effect, popping out of the image',
      'handwritten': 'large handwritten or marker-style font in white or yellow, casual and energetic, slightly tilted',
      'glitch': 'large bold font with a digital glitch/distortion effect, with red and cyan color shift, techy cyberpunk feel',
    }[textStyle] || 'very large, bold, white Impact-style font with a thick black outline';

    // Build direct prompt for Gemini
    const styleInstructions = {
      'face-left-text-right': `Edit this photo into a wide 16:9 landscape YouTube thumbnail. Completely remove the original background and replace it with a solid black background. Place the person on the left third, chest up, full head visible with space above. On the right two-thirds, render "${thumbText}" in ${textStyleDesc}. Background must be solid black, not purple, not blue ‚Äî pure black.`,

      'face-center-text-top': `Edit this photo into a wide 16:9 landscape YouTube thumbnail. Completely remove the original background and replace it with a bright saturated red (#CC0000) background. Place the person centered in the lower half, chest up. Display "${thumbText}" in ${textStyleDesc} across the top third. High contrast between red background and text.`,

      'face-with-icon': `Edit this photo into a wide 16:9 landscape YouTube thumbnail. Completely remove the original background and replace it with a solid dark teal (#0D3B3B) background. Person on the left, chest up. On the right, add a large glowing white or cyan icon related to "${topic.substring(0, 50)}" next to "${thumbText}" in ${textStyleDesc}.`,

      'screenshot-reaction': `Edit this photo into a wide 16:9 landscape YouTube thumbnail. Left 60%: a realistic dark-themed VS Code editor with colorful syntax-highlighted code. Right 40%: the person from the photo, chest up, background removed, appearing to react to the code. "${thumbText}" in ${textStyleDesc} across the bottom.`,

      'dramatic': `Edit this photo into a wide 16:9 landscape YouTube thumbnail. Completely remove the background and make it pitch black. Add dramatic warm orange/amber rim lighting from the left side illuminating only one half of the person's face. Person left of center, chest up. "${thumbText}" in ${textStyleDesc} on the right. Dark, moody, cinematic like a movie poster.`,

      'split': `Edit this photo into a wide 16:9 landscape YouTube thumbnail with a sharp vertical split. Left half: the person, chest up, on a completely black background. Right half: solid bright yellow (#FFD600) background with "${thumbText}" in large bold black font centered. Clean hard dividing line between halves.`,

      'podcast-style': `Edit this photo into a wide 16:9 landscape YouTube thumbnail. Remove the background and replace it with a warm cozy podcast studio: dark wood desk, soft warm amber bokeh lights, a silver microphone visible. Person centered, chest up. "${thumbText}" in ${textStyleDesc} at the top. Warm and inviting.`,

      'breaking-news': `Edit this photo into a wide 16:9 landscape YouTube thumbnail styled as TV breaking news. Person on the left, chest up, background removed. Replace background with a dark navy blue newsroom graphic with subtle grid pattern. Add a thick red (#FF0000) banner across the bottom third containing "${thumbText}" in large bold white text. Add a small red "BREAKING" label above the banner.`,

      'versus': `Edit this photo into a wide 16:9 landscape YouTube thumbnail. Person on the left third, chest up, background removed. A dramatic diagonal lightning bolt or energy crack splits the center. Right third has an opposing icon related to the topic. Background: navy blue on left, dark red on right. "${thumbText}" in ${textStyleDesc} at the top spanning both sides.`,

      'ranking-list': `Edit this photo into a wide 16:9 landscape YouTube thumbnail. Person on the right third, chest up, background removed. Replace background with solid dark green (#0A2E1A). Left two-thirds: a clean numbered list (1. 2. 3. 4.) with simple white icons, like a leaderboard. "${thumbText}" as a header at the top in ${textStyleDesc}.`
    };

    let geminiPrompt = `${styleInstructions[style] || styleInstructions['face-left-text-right']}

Important: Output must be 16:9 landscape. Preserve the person's face exactly. Do NOT keep the original background ‚Äî replace it completely as described. All text "${thumbText}" must be fully visible. No extra text.`;

    // Add video frame context if uploaded
    const frameData = photos[1];
    if (frameData) {
      geminiPrompt += `\n\nA reference frame from the actual video is also provided. Use it to match the mood, lighting, and color tone ‚Äî but do NOT copy its layout.`;
    }

    // Add extra images context
    if (extraPhotos.length > 0) {
      geminiPrompt += `\n\n${extraPhotos.length} additional image(s) are provided (logos, screenshots, icons, etc.). Incorporate them naturally into the thumbnail ‚Äî place them visibly alongside the text and person. They are important visual elements for this thumbnail.`;
    }

    promptEl.innerHTML = `<div class="prompt-preview">Text: ${thumbText} | Style: ${style}${frameData ? ' | + frame' : ''}${extraPhotos.length ? ` | + ${extraPhotos.length} extra` : ''}</div>`;

    const imgDataUrl = await callGeminiImage(geminiPrompt, faceData, frameData, extraPhotos);

    el.innerHTML = `
      <div class="thumbnail-item">
        <img src="${imgDataUrl}" alt="Generated thumbnail" />
      </div>
      <div class="thumbnail-actions">
        <a href="${imgDataUrl}" download="thumbnail.jpg" class="btn btn-secondary" style="text-decoration:none;font-size:12px;">Download</a>
        <button class="btn btn-ghost" style="font-size:12px;" onclick="generateThumbnail()">Regenerate</button>
      </div>`;
  } catch (err) {
    el.innerHTML = `<div class="thumbnail-item"><div class="loading" style="color:var(--accent)">${err.message}</div></div>`;
  }
}

// ============================================================================
// GENERATE ALL
// ============================================================================
async function generateAll() {
  const btn = document.getElementById('generateAll');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Generating...';

  try {
    await Promise.all([
      generateTitles(),
      generateDescription(),
      generateThumbnail(),
    ]);
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'Generate All';
  }
}

// ============================================================================
// UTILS
// ============================================================================
function copyText(text) {
  navigator.clipboard.writeText(text).then(() => showToast('Copied to clipboard'));
}

function showToast(msg) {
  const existing = document.querySelector('.toast');
  if (existing) existing.remove();
  const el = document.createElement('div');
  el.className = 'toast';
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 2000);
}
</script>
</body>
</html>
